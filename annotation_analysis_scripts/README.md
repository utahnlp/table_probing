# Annotation Parsing and Analysis Scripts

This folder contains scripts that:

* Take as input: 
    ** CSV file containing results from an annotation project in the Amazon MTURK format
    ** INFOTABS directory
* Give as output: statistics regarding the annotations and annotators


## For Template: `table_peturbation_template.html`

### Run the data analysis

To run on a single MTurk data file, place the CSV file inside a folder `<root_folder>/batches` and run:

```
./run.sh <name of CSV file WITHOUT the .csv extension>
```

for example, if `data.csv` is inside the folder `batches`:

```
./run.sh data
```

To collate all data files within a directory and run on them all together, run:

```
./run.sh --folder <path to folder>
```

For example if you want to run on all CSV files in the `batches` folder, run:

```
./run.sh batches
```

### Run For Feedback Field Results

Example:

```
python3 src/feedback.py batches/Batch_4317904_batch_results.csv > feedback.txt
```

### Generate HTML File For Annotator

USED WITH: Batch results as generated by the above two scripts.

To generate a HTML file showing an annotator's hits (annotator identified by annotator ID) in a particular batch, run- for example-

```
python3 src/annotator_markings.py batches/Batch_2_0_results.csv AE03LUY7RH400
```

The results will be in a file called `<annotator_id>.html`

### Results

Results generated by the above scripts are stored in `./results` . All files for a particular batch are prefixed by some common `$PREFIX`

The format of results file names are:

- $PREFIX_annotations.csv: CSV file containing each table-hypothesis pair and all the annotations on that given pair

- Annotator statistics files:
    - $PREFIX_annotators_majority: agreement stats w.r.t majority
    - $PREFIX_annotators_majority_normal: same as above but row-normalized
    - $PREFIX_annotators_pairwise: agreement stats w.r.t each annotator pair
    - $PREFIX_annotators_pairwise_normal: same as above but row-normalized

### Pipeline For Each Batch

- Store data in `tableQA-peturbation/batches/`
- Collate Tables (integrate.sh)
- Make Samples and Annotators CSV (run_processor.sh)
- Get Agreement Stats, precision and recall (run_agreement.sh)


## Files

### `process_data.py`

Inputs:

```
$ python process_data.py <csv file to get data from> \
                       <file prefix to write data to>
```

Subfiles:
    - `sample.py` : class/methods for each sample (row of CSV)
    - `annotator.py` : Annotator, annotator scoring methods, annotator csv writing methods
    - `table_hyp_pair.py` : single table-hypothesis pair and all samples of it

### `agreement.py`

Inputs:

```
python3 src/agreement.py <file prefix that processed data has been written to>
```

### `individual_disagreement.py`

This file is not really relevant unless you want a visual of the disagreement on rows.

### `inter_batch_disagreement.py`

Inputs:

```
python inter_batch_disagreement.py <batch 1 annotations csv> \
                                   <batch 2 annotations csv> \
                                   <file to write to csv>
``` 

